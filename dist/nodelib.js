require("source-map-support").install(),module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=6)}([function(t,e){t.exports=require("lodash")},function(t,e){function r(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}r.keys=function(){return[]},r.resolve=r,t.exports=r,r.id=1},function(t,e){var r;r=function(){class t extends Error{}return t}.call(this),t.exports={types:{NonExistantPathElementException:r}}},function(t,e,r){var n,o,s,i,a,l,u,c,h;u=r(4),s=r(9),h=r(10),n=r(0),o=r(11),Array.isArray,l=["main.meta","module.meta",".meta"],a=function(t){var e,r,n,o;for(e=0,r=l.length;e<r;e++)if(n=l[e],o=u.join(t,n),s.existsSync(o))return h.safeLoad(s.readFileSync(o,"utf8"))},i=function(t,e){var r,o,s,i;if(i=a(t),!n.isEmpty(i)){if(n.isEmpty(e))return i;if(n.isArray(i))for(r=0,s=i.length;r<s;r++)if(null!=(o=i[r]).type&&o.type===e)return o;return n.isObject(i)?null!=i.type&&i.type===e?i:null:void 0}},c=function(t,e){var r,n,o,s,i,a;for(a=e.type.split("/")[1],e.path=t,e.ext_version=a,e.components||(e.components=["models","views","controllers"]),o=0,s=(i=e.components).length;o<s;o++)r=i[o],n=u.join(t,r),e[r.substring(0,r.length-1)+"Path"]=n;return e},t.exports={loadDir:a,load:i,resolve_mvc_meta:c,readJrcModDef:function(t,e){var r,o,i;return o=u.join(t.dir),r=s.readFileSync(o,"ascii"),i=parseJrcHeader(r),n.defaults(i,{id:u.join(t.name),deps:null,title:null,description:null})},parseJrcHeader:function(t){var e,r,n,s,i,a,l,u,c,h;for(u={},i=0,l=(s=o.firstComment(t)).length;i<l;i++)-1!==(c=(n=s[i]).indexOf(" "))&&(h=n.substr(0,c),e=n.substr(c+1),-1!==(c=h.indexOf(":"))&&"jrc"===h.substr(0,c)&&("export"===(a=h.substr(c+1))&&(u.id=e.trim()),"import"===a&&(r=e.trim().split(" "),u.deps=r),"description"===a&&(u.description=e.trim()),"title"===a&&(u.title=e.trim())));return u}}},function(t,e){t.exports=require("path")},function(t,e,r){var n,o,s;n=r(0),s=function(t,e){var r,n;return[n,r]=e.substr(0,e.length-1).split("("),new t.core.base.type[n](t,r)},o=function(t,e,r){var i,a,l,u,c,h,p,f,d,m,_,v;if(!t)throw new Error("Missing app");for(h in m={},p=r.route)for(d=p[h],v=[e,h].join("/").replace("$",":"),d.route&&(_=o(t,v,d),n.extend(m,_)),l=0,u=(f=["all","get","put","post","options","delete"]).length;l<u;l++)(i=d[c=f[l]])&&(v in m||(m[v]={}),c in m[v]&&console.error("Already routed: ",c,v),m[v][c]=i,n.isArray(i)?t[c].apply(t,[v,...i]):n.isString(i)?(a=s(r,i),t[c](v,n.bind(a[c],a))):t[c](v,i));return m},t.exports={applyRoutes:o}},function(t,e,r){t.exports=r(7)},function(t,e,r){t.exports={Context:r(8),metadata:r(3),module:r(13),route:r(5),error:r(2),util:r(16),version:"0.0.8"}},function(t,e,r){var n,o,s,i,a;o=r(0),i=r(2),s=function(t){return o.defaults(t,{enumerable:!1,configurable:!0})},a=function(t){if(!t.match(/^#\/.*/))throw new Error("Absolute JSON ref only support");return t.substr(2).replace(/([^\\])\//g,"$1.").replace(/\\\//g,"/")},(n=class t{constructor(e,r=null){this.class=t,this._instance=++t._i,this.context=r,this._data={},this._subs=[],r&&r._data&&this.prepare_from_obj(r._data),this.add_data(e)}id(){return this.context?this.context.id()+"."+this._instance:this._instance}toString(){return"Context:"+this.id()}isEmpty(){return o.isEmpty(this._data&&(!this.context||this.context.isEmpty()))}subs(){return this._subs}root(){var t;for(t=this;t.context;)t=t.context;return t}seed(t){var e,r;for(e in t)r=t[e],this._data[e]=r;return this}prepare_from_obj(t){var e;for(e in t)t[e],this.prepare_property(e);return this}prepare_all(t){var e,r,n;for(e=0,n=t.length;e<n;e++)r=t[e],this.prepare_property(r);return this}prepare_property(t){if(!(t in this._data))return this._ctx_property(t,{get:this._ctxGetter(t),set:this._ctxSetter(t)}),this}add_data(t){return this.prepare_from_obj(t),this.seed(t)}getSub(t){var e;return e=new class extends this.class{}(t,this),this._subs.push(e),e}get(t){var e,r,n;for(n=t.replace(/([^\\])\./g,"$1\n").replace(/\\\./,".").split("\n"),e=this;n.length;){if(!((r=n.shift())in e))throw console.error(`no ${r} of ${t} in`,e),new i.types.NonExistantPathElementException(`Unable to get ${r} of ${t}`);e=e[r]}return e}put(t,e){var r,n,o;for(o=t.replace(/([^\\])\./g,"$1\n").replace(/\\\./,".").split("\n"),r=this;o.length-1;){if(!((n=o.shift())in r))throw console.error(`no ${n} of ${t} in`,r),new i.types.NonExistantPathElementException(`Unable to get ${n} of ${t}`);r=r[n]}return r[n=o.shift()]=e,null}resolve(t,e){var r,n,s,i,l,u;if(i=t.replace(/([^\\])\./g,"$1\n").replace(/\\\./,".").split("\n"),r=function(t){var e,r;return e=t,r=l.get(a(t.$ref)),o.isPlainObject(r)&&(r=o.merge(e,r)),r},"$ref"in(n=l=this))try{n=r(n)}catch(t){if(null!=e)return e;throw t}for(;i.length;){if(!((s=i.shift())in n))throw console.error(`no ${s} of ${t} in`,n),new Error(`Unable to resolve ${s} of ${t}`);if((n=n[s],o.isObject(n))&&"$ref"in n)try{n=r(n)}catch(t){if(null!=e)return e;throw t}}return o.isPlainObject(n)?(u=this.merge(n)).$ref?u.$ref:u:n}_clean(t){var e,r,n;for(e in t)r=t[e],o.isPlainObject(r)&&("$ref"in(n=o.clone(r))&&delete n.$ref,this._clean(n),t[e]=n);return t}merge(e){var r,n,s;return s=this,n=function(t){var e,r;return e=s.get(a(t.$ref)),o.isPlainObject(e)?(r=s.merge(e),delete t.$ref,o.merge(t,r)):e},r=function(e,s,i){var a,l,u,c,h,p;if("$ref"!==i){if(o.isArray(s))for(l=a=0,h=s.length;a<h;l=++a)u=s[l],r(s,u,l);else if(o.isPlainObject(s)||s instanceof t)if("$ref"in s)s=n(s);else for(c in s)p=s[c],r(s,p,c);else if(!(null===s||o.isString(s)||o.isNumber(s)||o.isBoolean(s)||o.isFunction(s)))throw new Error(`Unhandled value '${s}'`);return e[i]=s,e}s=n({$ref:s})},o.transform(e,r)}to_dict(){var t,e;for(e={},t=this;t;)e=o.merge(e,t._data),t=t.context;return e}_ctx_property(t,e){return s(e),Object.defineProperty(this,t,e)}_ctxGetter(t){return function(){return t in this._data?this._data[t]:null!=this.context?this.context[t]:void 0}}_ctxSetter(t){return function(e){return this._data[t]=e}}static count(){return t._i}static reset(){return t._i=0}}).reset(),t.exports=n},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("js-yaml")},function(t,e,r){var n,o,s,i,a,l;l=r(12),o=r(0),n=class{constructor(t,e=l.EOL,r=[]){this.str=t,this.eol=e,this.lines=r}hasNext(){return!o.isEmpty(this.str)}next(){var t,e;return(e=this.str.indexOf(this.eol))>-1?(t=this.str.substr(0,e),this.str=this.str.substr(e+this.eol.length)):(t=this.str,this.str=""),this.lines.push(t),t}},a=function(t){return"#"===t.trim().substr(0,1)},s=function(t){return t.trim().substr(1).trim()},i=function(t){var e,r,o;for(o=[],r=new n(t);r.hasNext();)e=r.next(),a(e)&&o.push(s(e));return o},t.exports={firstComment:i,isLineComment:a,cleanLineComment:s}},function(t,e){t.exports=require("os")},function(t,e,r){(function(t){var e,n,o,s,i,a,l,u,c,h,p,f,d,m,_=[].indexOf;f=r(4),i=r(0),m=r(15),h=r(3),l=r(5).applyRoutes,a=function(t,e){var r,n,o,s;if(e.params){for(n in s=[],o=e.params)r=o[n],s.push(t.param(n,r));return s}},e=class{constructor(t){({app:this.app,server:this.server,root:this.root,pkg:this.pkg,config:this.config,meta:this.meta,url:this.url,path:this.path,route:this.route}=t),this.base={},this.controllers={},this.routes={},this.models={},this.params={}}static load_config(t){return{}}configure(){return console.log("TODO component.configure",[this.name,this.meta,this.base,this.path,this.route]),this.load_controllers()}load_models(){return Base.plugin("registry")}load_controllers(){var t;if(this.meta.controllers)return t=this.meta.controllers,i.isArray(t)?this.load_controller_names():i.isObject(t)&&!i.isEmpty(t)?this.update_controller(t):void 0;console.warn("No controllers for component",this.name)}load_model(t){var e;return this.models[t]||(e=f.join(this.modelPath,t),this.models[t]=r(1)(e).define(this.modelbase)),this.models[t]}load_controller_names(){var t,e,n,o,s,i,a,l,u;for(i=this.root||this.path,l=[],o=0,s=(a=this.meta.controllers).length;o<s;o++){t=a[o],e=f.join(i,t),this.controllers[t]=r(1)(e);try{u=this.controllers[t](this,this.base)}catch(e){throw n=e,console.error(`Unable to load ${t}`),n}this.update_controller(u),l.push(console.log(`Component: ${this.name} loaded`,t,"controller"))}return l}update_controller(t){var e;if(e=this.core||this,t.meta&&i.merge(e.meta,t.meta),t.params&&i.merge(this.params,t.params),t.route)return i.merge(this.route,t.route)}},n=class extends e{constructor(t){super(t),this.name=this.name||"core"}configure(){var t;return t=this.root||this.path,this.name=this.name||this.meta.name,this.controllerPath||(this.controllerPath=f.join(t,"controllers")),this.modelPath||(this.modelPath=f.join(t,"models")),this.viewPath||(this.viewPath=f.join(t,"views")),this.load_models(),this.load_controllers(),this.apply_controllers()}apply_controllers(){var t;if(i.extend(this.routes,l(this.app,this.url,this)),a(this.app,this),this.meta.default_route)return t=f.join(this.url,this.meta.default_route),this.app.all(this.url,this.base.redirect(t))}static config(t,e){var n,o;return n=f.join(__noderoot,e,"main"),o=r(1)(n)(e),i.defaults(o,{route:{}}),o}},o=function(){class t extends n{constructor(t){super(t),this.modules={}}configure(){var t;return this.url=this.url||"",this.modelPath=f.join(this.root,"models"),t=this,this.app.use((function(e,r,n){return r.locals.core=t,r.locals.modules=[],n()})),super.configure()}load_modules(){var t,e,r,n,o,a,l,u;for(a=f.join(__noderoot,this.config.src||"src"),u=[],e=0,r=(l=i.extend([],this.config.modules,this.meta.modules)).length;e<r;e++)o=l[e],t=f.join(a,o),(n=s.load(this,t)).configure(),this.modules[n.meta.name]=n,console.log("Loaded module",o,n.meta.name),u.push(console.log(n.route));return u}get_all_components(){var t;return t=[this],i.union(t,i.values(this.modules))}start(){var t;return t=this,this.server.listen(this.app.get("port"),(function(){return console.log("Express server listening on port "+t.app.get("port"))}))}static load(e){var r,n,o,s,i;for((o=h.load(e))||(console.warn("No metadata for core",e),o=t.DEFAULT_METADATA),r=0,n=o.length;r<n;r++)if(!(!1 in(s=o[r]))&&(i=s.type,_.call(t.SUPPORTED,i)>=0))return t.load_from_metadata(e,s);throw new Error(`No known core interface on module at ${e}`)}static load_from_metadata(e,r){var n,o;return o=(n=t).config([r],e),new n(o)}}return t.DEFAULT_METADATA=[{type:"express-mvc-core/0.2"}],t.SUPPORTED=["express-mvc-core/0.1","express-mvc-core/0.2"],t}.call(this),s=function(){class t extends e{constructor(t){t.name||(t.name="ModuleV01"),super(t),({core:this.core}=t)}static load(e,r){var n,o,s,i,a;for((s=h.load(r))||(console.warn("No metadata for module",r),s=t.DEFAULT_METADATA),n=0,o=s.length;n<o;n++)if(!(!1 in(i=s[n]))&&(a=i.type,_.call(t.SUPPORTED,a)>=0))return t.load_from_metadata(e,r,i);throw new Error(`No known extension interface on module at ${r}`)}static load_from_metadata(t,e,r){var n,o,s;return(o=h.resolve_mvc_meta(e,r)).controllers||console.error("Missing MVC meta for ",r),s=(n=p[o.ext_version]).config(t,o,e),new n(s)}static config(t,e,r){return{meta:e||{name:e.name},config:e.config||{},route:e.route||{},core:t,app:t.app,base:t.base,path:r}}}return t.DEFAULT_METADATA=[{type:"express-mvc-ext/0.2"}],t.SUPPORTED=["express-mvc-ext/0.1","express-mvc-ext/0.2"],t}.call(this),p={.1:s,.2:s},d={instances:{},projects:{},apps:{}},u=function(t,e=null){var r;return d.projects[t]?r=d.projects[t]:(r=m.v4(),d.projects[t]=r),global.__noderoot=t},c=function(t){var e,r;return global.__approot=t,d.apps[t]?e=d.apps[t]:(e=m.v4(),d.apps[t]=e),global.__appid=e,d.instances[e]?r=d.instances[e]:d.instances[e]=r=o.load(t),r},t.exports={session:d,init:u,classes:{Core:o,Module:s},load_core:c,load_and_start:function(t){var e;return u(process.cwd()),(e=c(t)).configure(),e.load_modules(),e.start()}}}).call(this,r(14)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){t.exports=require("uuid")},function(t,e){e.errors=function(t){var e,r;return r=Object.keys(t),e=[],r?(r.forEach((function(r){e.push(t[r].message)})),e):["Oops! There was an error"]},e.indexof=function(t,e){var r,n;return r=-1,n=Object.keys(e),t.filter((function(t,o){var s,i;for(i=0,s=n.length-1;s>=0;){if(t[n[s]]===e[n[s]]&&++i===n.length)return r=o,o;s--}})),r},e.findByParam=function(t,r,n){var o;return~(o=e.indexof(t,r))&&"function"==typeof n?n(void 0,t[o]):~o&&!n?t[o]:~o||"function"!=typeof n?void 0:n("not found")}}]);
//# sourceMappingURL=nodelib.js.map
